import{jsxs as s,jsx as e}from"react/jsx-runtime";import{useSetAtom as F,useAtom as Z}from"jotai";import{z as J,x as ee,B as l,L as y,g as se,G as L,D as K,af as re,H as te,C as j,k as ae,a as P,b as T,T as A,p as S,q as U,r as R,c as M,h as z,d as D,F as O}from"./ssr-BSSvUmX6.js";import{FolderPlus as Q,Lock as Y,PlusCircle as ie,Home as le,ChevronRight as ce,Briefcase as B,Settings as E,FileText as ne,Users as W,RefreshCw as oe,ChevronDown as H,ChevronUp as q}from"lucide-react";import{useState as x,useEffect as V}from"react";import{useNavigate as de,Link as $}from"@tanstack/react-router";import{S as f,M as me,C as he,a as pe,b as ue}from"./collapsible-DPhAy_Tj.js";import{toast as k}from"sonner";import{D as ge,a as fe,b as xe,c as Ne,d as ve,e as be,f as we,g as Ce}from"./dialog-Dg_okaGf.js";import{C as ye}from"./checkbox-DBeqRmac.js";import{A as G}from"./avatar-DxBgJCBX.js";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"zod";import"@radix-ui/react-slot";import"class-variance-authority";import"clsx";import"tailwind-merge";import"@radix-ui/react-label";import"better-auth/react";import"better-auth/client/plugins";import"input-otp";import"@radix-ui/react-select";import"@radix-ui/react-tooltip";import"@radix-ui/react-radio-group";import"@radix-ui/react-scroll-area";import"framer-motion";import"motion/react";import"@radix-ui/react-dropdown-menu";import"uuid";import"marked";import"react-markdown";import"remark-gfm";import"@radix-ui/react-hover-card";import"qss";import"@radix-ui/react-dialog";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"@radix-ui/react-tabs";import"@radix-ui/react-collapsible";import"@radix-ui/react-checkbox";import"@radix-ui/react-avatar";function X({teamspaceId:p,children:o}){const N=de(),[d,u]=x(!1),c=F(J),v=F(ee),[i,n]=x({name:"",description:"",context:"",isPrivate:!1}),m=r=>{n({...i,[r.target.name]:r.target.value})},b=r=>{n({...i,isPrivate:r})};return s(ge,{children:[e(fe,{asChild:!0,children:o||s(l,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white hover:cursor-pointer",children:[e(Q,{className:"h-4 w-4 mr-2"})," New Project"]})}),e(xe,{className:"sm:max-w-[500px]",children:s("form",{onSubmit:async r=>{if(r.preventDefault(),!i.name.trim()){k.error("Project name is required");return}u(!0);try{const a=K(),g=(await a.auth.handler()).userID,{data:h}=await a.chatrooms.createProject({teamspaceId:p,name:i.name,description:i.description,context:i.context,creatorId:g,isPrivate:i.isPrivate,members:[{projectId:"",userId:g,role:"OWNER",invitedByUserId:g,hasAccepted:!0}]});v(h.id),c(I=>I.map(C=>C.id===p?{...C,projects:[...C.projects,h]}:C)),k.success("Project created successfully"),N({to:"/project/$projectId",params:{projectId:h.id},viewTransition:!0})}catch(a){console.error("Error creating project:",a),k.error("Failed to create project")}finally{u(!1)}},children:[s(Ne,{children:[e("div",{className:"h-1.5 bg-emerald-500 w-full absolute top-0 left-0 rounded-t-lg"}),e(ve,{className:"text-xl mt-2",children:"Create New Project"}),e(be,{children:"Create a project in this teamspace to organize your work."})]}),s("div",{className:"grid gap-4 py-4",children:[s("div",{className:"grid gap-2",children:[s(y,{htmlFor:"project-name",children:["Project Name ",e("span",{className:"text-red-500",children:"*"})]}),e(se,{id:"project-name",name:"name",value:i.name,onChange:m,placeholder:"e.g. Marketing Campaign",required:!0})]}),s("div",{className:"grid gap-2",children:[e(y,{htmlFor:"project-description",children:"Description"}),e(L,{id:"project-description",name:"description",value:i.description,onChange:m,placeholder:"What is this project about?"})]}),s("div",{className:"grid gap-2",children:[e(y,{htmlFor:"project-context",children:"Context"}),e(L,{id:"project-context",name:"context",value:i.context,onChange:m,placeholder:"Any specific context for this project"})]}),s("div",{className:"flex items-center space-x-2",children:[e(ye,{id:"isPrivate",checked:i.isPrivate,onCheckedChange:b}),s("div",{className:"grid gap-1.5 leading-none",children:[s(y,{htmlFor:"isPrivate",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center",children:[e(Y,{className:"h-3.5 w-3.5 mr-1.5 text-muted-foreground"}),"Make project private"]}),e("p",{className:"text-xs text-muted-foreground",children:"Private projects are only visible to invited members"})]})]})]}),s(we,{children:[e(Ce,{asChild:!0,children:e(l,{variant:"outline",type:"button",disabled:d,children:"Cancel"})}),e(l,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700",disabled:d,children:d?"Creating...":"Create Project"})]})]})})]})}const _=p=>{switch(p){case"OWNER":return"bg-green-100 text-green-800 border-green-200";case"ADMIN":return"bg-red-100 text-red-800 border-red-200";case"CONTRIBUTOR":return"bg-blue-100 text-blue-800 border-blue-200";case"VIEWER":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};function je({members:p}){const[o,N]=x(!1),[d,u]=x(!1),c=5,v=p.filter((t,g,h)=>g===h.findIndex(I=>I.user?.id===t.user?.id)),i=v.filter(t=>!t.hasLeft),n=v.filter(t=>t.hasLeft),m=(t,g)=>{const h={OWNER:0,ADMIN:1,CONTRIBUTOR:2,VIEWER:3};return(h[t.role]||4)-(h[g.role]||4)},b=[...i].sort(m),w=[...n].sort(m),r=o?b:b.slice(0,i.length>=c?c:i.length),a=i.length>c&&!o;return s("div",{className:"space-y-3",children:[e("div",{children:r.map(t=>e("div",{className:"py-1.5",children:s("div",{className:"flex items-center justify-between group",children:[s("div",{className:"flex items-center gap-2",children:[e(G,{className:"h-7 w-7",children:t.user?.image?e("img",{src:t.user.image,alt:t.user?.name||"User"}):e("div",{className:"bg-gray-200 h-full w-full flex items-center justify-center text-gray-700 text-xs",children:(t.user?.name||"U").charAt(0)})}),e(A,{children:s(S,{children:[e(U,{asChild:!0,children:e("span",{className:"text-sm font-medium truncate max-w-[120px]",children:t.user?.name||"Unknown User"})}),s(R,{children:[e("p",{children:t.user?.name||"Unknown User"}),e("p",{className:"text-xs text-muted-foreground",children:t.user?.email})]})]})})]}),e(O,{className:_(t.role),children:t.role})]})},t.id))}),a&&e(l,{variant:"ghost",size:"sm",className:"w-full text-xs h-7",onClick:()=>N(!0),children:s("span",{className:"flex items-center",children:["Show ",i.length-c," More ",e(H,{className:"ml-1 h-3 w-3"})]})}),o&&i.length>c&&e(l,{variant:"ghost",size:"sm",className:"w-full text-xs h-7",onClick:()=>N(!1),children:s("span",{className:"flex items-center",children:["Show Less ",e(q,{className:"ml-1 h-3 w-3"})]})}),n.length>0&&s(he,{open:d,onOpenChange:u,className:"mt-3",children:[s("div",{className:"flex items-center text-xs text-muted-foreground",children:[e("div",{className:"h-px bg-border flex-grow mr-2"}),e(pe,{asChild:!0,children:s("button",{className:"flex items-center gap-1 px-2 py-1 rounded-sm hover:bg-muted/50 transition-colors",children:[s("span",{children:["Former Members (",n.length,")"]}),d?e(q,{className:"h-3 w-3"}):e(H,{className:"h-3 w-3"})]})}),e("div",{className:"h-px bg-border flex-grow ml-2"})]}),e(ue,{className:"pt-2",children:e("div",{className:"space-y-1.5",children:w.map(t=>e("div",{children:s("div",{className:"relative flex items-center justify-between group py-1.5",children:[e("div",{className:"absolute inset-0 rounded-md bg-muted/30 pointer-events-none"}),s("div",{className:"flex items-center gap-2 z-10",children:[s("div",{className:"relative",children:[e(G,{className:"h-7 w-7",children:t.user?.image?e("img",{src:t.user.image,alt:t.user?.name||"User",className:"filter grayscale"}):e("div",{className:"bg-gray-200 h-full w-full flex items-center justify-center text-gray-700 text-xs",children:(t.user?.name||"U").charAt(0)})}),e("div",{className:"absolute -bottom-1 -right-1 rounded-full w-3 h-3 bg-muted border border-background flex items-center justify-center",children:e("span",{className:"text-[8px]",children:"Ã—"})})]}),e(A,{children:s(S,{children:[e(U,{asChild:!0,children:e("span",{className:"text-sm font-medium truncate max-w-[120px] text-muted-foreground",children:t.user?.name||"Unknown User"})}),s(R,{children:[e("p",{children:t.user?.name||"Unknown User"}),e("p",{className:"text-xs text-muted-foreground",children:t.user?.email}),e("p",{className:"text-xs text-red-500 mt-1",children:"No longer a member"})]})]})})]}),e(O,{className:`${_(t.role)} opacity-70`,children:t.role})]})},t.id))})})]})]})}const xs=function(){const{teamspaceId:o}=re.useParams(),[N,d]=Z(J),[u,c]=x(!1),[v,i]=x(!0),{data:n,isPending:m}=te(),[b,w]=x("");V(()=>{n&&w(n.session.userId)},[m,n]);const r=N.find(a=>a.id===o);return V(()=>{r&&i(!1)},[r]),v?s("div",{className:"flex-1 flex flex-col",children:[e("div",{className:"h-1.5 bg-gray-200 w-full"}),s("div",{className:"p-6 max-w-5xl mx-auto w-full flex-1",children:[s("div",{className:"mb-8 relative",children:[e(f,{className:"h-10 w-60 mb-2"}),e(f,{className:"h-4 w-full max-w-md mb-4"})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e("div",{className:"md:col-span-2 space-y-6",children:s("div",{children:[e("div",{className:"flex justify-between items-center mb-4",children:e(f,{className:"h-8 w-40"})}),s("div",{className:"space-y-3",children:[e(f,{className:"h-24 w-full"}),e(f,{className:"h-24 w-full"})]})]})}),s("div",{className:"space-y-6",children:[e(f,{className:"h-60 w-full"}),e(f,{className:"h-60 w-full"})]})]})]})]}):r?s("div",{className:"flex-1 flex flex-col",children:[e("div",{className:"h-1.5 bg-indigo-500 w-full"}),s("div",{className:"p-6 max-w-5xl mx-auto w-full flex-1",children:[s("div",{className:"flex items-center text-sm text-muted-foreground mb-4",children:[s($,{to:"/chat",className:"flex items-center hover:text-foreground transition-colors",children:[e(le,{className:"h-3.5 w-3.5 mr-1"}),"Home"]}),e(ce,{className:"h-3.5 w-3.5 mx-1.5"}),s("span",{className:"font-medium text-foreground flex items-center",children:[e(B,{className:"h-3.5 w-3.5 mr-1.5"}),"Teamspace"]})]}),s("div",{className:"mb-8 relative",children:[s("div",{className:"flex items-center gap-3 mb-2",children:[e("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-100 text-indigo-700",children:e(B,{className:"h-5 w-5"})}),s("div",{children:[e("h1",{className:"text-3xl font-bold",children:r.name}),s("div",{className:"flex items-center mt-1",children:[e("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-600/20",children:"Teamspace"}),r.members&&r.members.length>0&&s("span",{className:"ml-2 text-sm text-muted-foreground",children:[r.members.length," member",r.members.length!==1?"s":""]})]})]})]}),e("div",{className:"mt-2",children:e("p",{className:"text-muted-foreground",children:r.description||"No description provided"})}),e("div",{className:"absolute top-0 right-0",children:s(l,{size:"sm",variant:"outline",children:[e(E,{className:"h-4 w-4 mr-2"})," Teamspace Settings"]})})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s("div",{className:"md:col-span-2 space-y-6",children:[s("div",{children:[s("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold",children:"Projects"}),e(X,{teamspaceId:r.id})]}),r.projects&&r.projects.length>0?e("div",{className:"space-y-3",children:r.projects.map(a=>e(j,{className:ae("cursor-pointer transition-all border-l-4 border-l-transparent","hover:shadow-md hover:border-l-indigo-500 hover:bg-muted/30"),children:s($,{to:"/project/$projectId",params:{projectId:a.id},className:"block",children:[s(P,{className:"pb-2",children:[s(T,{className:"text-lg flex items-center",children:[a.name,a.isPrivate&&e(A,{children:s(S,{children:[e(U,{asChild:!0,children:e("span",{children:e(Y,{className:"h-3 w-3 ml-2 text-red-500"})})}),e(R,{children:e("p",{children:"Private"})})]})})]}),e(M,{children:a.description||"No description"})]}),e(z,{className:"pt-2 text-sm text-muted-foreground",children:s("div",{className:"flex items-center gap-4",children:[s("div",{className:"flex items-center",children:[e(ne,{className:"h-4 w-4 mr-1"}),a.chatrooms?.length||0," chat",a.chatrooms?.length!==1?"s":""]}),s("div",{className:"flex items-center",children:[e(W,{className:"h-4 w-4 mr-1"}),a.members?.length||1," member",a.members?.length!==1?"s":""]})]})})]})},a.id))}):s("div",{className:"border rounded-lg p-8 text-center bg-muted/20",children:[e("h3",{className:"font-medium mb-2",children:"No projects yet"}),e("p",{className:"text-muted-foreground mb-4",children:"Start by creating your first project in this teamspace"}),e(X,{teamspaceId:o,children:s(l,{variant:"outline",children:[e(Q,{className:"h-4 w-4 mr-2"})," Create Project"]})})]})]}),s("div",{children:[e("h2",{className:"text-xl font-semibold mb-4",children:"Recent Activity"}),e("div",{className:"border rounded-lg p-4 bg-muted/20 text-center",children:e("p",{className:"text-muted-foreground",children:"Activity feed coming soon"})})]})]}),s("div",{className:"space-y-6",children:[s(j,{className:"border-t-4 border-t-indigo-500",children:[s(P,{children:[s(T,{className:"flex items-center justify-between",children:[e("span",{children:"Teamspace Context"}),e(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:cursor-pointer",onClick:()=>c(!u),children:e(E,{className:"h-4 w-4"})})]}),e(M,{children:"Add context about what this teamspace is for"})]}),e(D,{children:u?s("div",{className:"space-y-4",children:[e("textarea",{className:"w-full min-h-[150px] p-3 border rounded-md",placeholder:"Describe what this teamspace is used for...",value:r.context}),s("div",{className:"flex justify-end space-x-2",children:[e(l,{variant:"outline",size:"sm",onClick:()=>c(!1),children:"Cancel"}),e(l,{size:"sm",onClick:()=>c(!1),children:"Save"})]})]}):e("div",{className:"text-sm",children:e("p",{children:r.context})})})]}),s(j,{className:"border-t-4 border-t-indigo-500",children:[s(P,{children:[e(T,{children:"Members"}),e(M,{children:"People with access to this teamspace"})]}),e(D,{children:r.members&&r.members.length>0?e(je,{members:r.members}):e("div",{className:"text-sm text-muted-foreground",children:"Only you have access to this teamspace"})}),e(z,{children:e(me,{type:"teamspace",teamspaceId:r.id,members:r.members||[],userId:b,onMembersChanged:()=>{K().chatrooms.getTeamspaces().then(({data:a})=>{a&&d(a)})},children:s(l,{size:"sm",variant:"outline",className:"w-full border-indigo-600/20 text-indigo-700 hover:bg-indigo-50 hover:cursor-pointer",children:[e(W,{className:"h-4 w-4 mr-2"})," Manage Members"]})})})]}),s(j,{className:"border-t-4 border-t-indigo-500",children:[e(P,{children:s(T,{className:"flex items-center justify-between",children:[e("span",{children:"Teamspace Stats"}),e(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e(oe,{className:"h-4 w-4"})})]})}),e(D,{children:s("div",{className:"space-y-2",children:[s("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Projects"}),e("span",{className:"font-medium",children:r.projects?.length||0})]}),s("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Members"}),e("span",{className:"font-medium",children:r.members?.length||0})]}),s("div",{className:"flex justify-between",children:[e("span",{className:"text-muted-foreground",children:"Created"}),e("span",{className:"font-medium",children:new Date(r.createdAt).toLocaleDateString()})]})]})})]})]})]})]})]}):s("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center",children:[e("h2",{className:"text-2xl font-bold mb-4",children:"No teamspace selected"}),e("p",{className:"text-muted-foreground mb-6",children:"Select a teamspace from the sidebar to view its details and projects"}),s(l,{variant:"outline",children:[e(ie,{className:"h-4 w-4 mr-2"})," Create New Teamspace"]})]})};export{xs as component};
